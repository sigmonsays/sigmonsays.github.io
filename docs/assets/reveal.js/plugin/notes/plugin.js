import speakerViewHTML from"./speaker-view.html";import{marked}from"marked";const Plugin=()=>{let o,e=null,t;function s(){if(e&&!e.closed)e.focus();else{if(e=window.open("about:blank","reveal.js - Notes","width=1100,height=700"),e.marked=marked,e.document.write(speakerViewHTML),!e){alert("Speaker view popup failed to open. Please make sure popups are allowed and reopen the speaker view.");return}c()}}function r(t){e&&!e.closed?e.focus():(e=t,window.addEventListener("message",i),a())}function c(){const n=t.getConfig().url,s=typeof n=="string"?n:window.location.protocol+"//"+window.location.host+window.location.pathname+window.location.search;o=setInterval(function(){e.postMessage(JSON.stringify({namespace:"reveal-notes",type:"connect",state:t.getState(),url:s}),"*")},500),window.addEventListener("message",i)}function l(n,s,o){let i=t[n].apply(t,s);e.postMessage(JSON.stringify({namespace:"reveal-notes",type:"return",result:i,callId:o}),"*")}function n(){let i=t.getCurrentSlide(),o=i.querySelectorAll("aside.notes"),a=i.querySelector(".current-fragment"),s={namespace:"reveal-notes",type:"state",notes:"",markdown:!1,whitespace:"normal",state:t.getState()};if(i.hasAttribute("data-notes")&&(s.notes=i.getAttribute("data-notes"),s.whitespace="pre-wrap"),a){let e=a.querySelector("aside.notes");e?(s.notes=e.innerHTML,s.markdown=typeof e.getAttribute("data-markdown")=="string",o=null):a.hasAttribute("data-notes")&&(s.notes=a.getAttribute("data-notes"),s.whitespace="pre-wrap",o=null)}o&&(s.notes=Array.from(o).map(e=>e.innerHTML).join(`
`),s.markdown=o[0]&&typeof o[0].getAttribute("data-markdown")=="string"),e.postMessage(JSON.stringify(s),"*")}function d(e){try{return window.location.origin===e.source.location.origin}catch{return!1}}function i(e){if(d(e)){let t=JSON.parse(e.data);t&&t.namespace==="reveal-notes"&&t.type==="connected"?(clearInterval(o),a()):t&&t.namespace==="reveal-notes"&&t.type==="call"&&l(t.methodName,t.arguments,t.callId)}}function a(){t.on("slidechanged",n),t.on("fragmentshown",n),t.on("fragmenthidden",n),t.on("overviewhidden",n),t.on("overviewshown",n),t.on("paused",n),t.on("resumed",n),n()}return{id:"notes",init:function(n){t=n,/receiver/i.test(window.location.search)||(window.location.search.match(/(\?|&)notes/gi)!==null?s():window.addEventListener("message",t=>{if(!e&&typeof t.data=="string"){let e;try{e=JSON.parse(t.data)}catch{}e&&e.namespace==="reveal-notes"&&e.type==="heartbeat"&&r(t.source)}}),t.addKeyBinding({keyCode:83,key:"S",description:"Speaker notes view"},function(){s()}))},open:s}};export default Plugin