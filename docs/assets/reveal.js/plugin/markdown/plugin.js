/*!
 * The reveal.js markdown plugin. Handles parsing of
 * markdown inside of presentations as well as loading
 * of external markdown documents.
 */import{marked}from"marked";const DEFAULT_SLIDE_SEPARATOR=`\r?
---\r?
`,DEFAULT_NOTES_SEPARATOR="notes?:",DEFAULT_ELEMENT_ATTRIBUTES_SEPARATOR="\\.element\\s*?(.+?)$",DEFAULT_SLIDE_ATTRIBUTES_SEPARATOR="\\.slide:\\s*?(\\S.+?)$",SCRIPT_END_PLACEHOLDER="__SCRIPT_END__",CODE_LINE_NUMBER_REGEX=/\[([\s\d,|-]*)\]/,HTML_ESCAPE_MAP={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Plugin=()=>{let e;function n(e){var o=e.querySelector("[data-template]")||e.querySelector("script"),t=(o||e).textContent,t=t.replace(new RegExp(SCRIPT_END_PLACEHOLDER,"g"),"<\/script>"),n=t.match(/^\n?(\s*)/)[1].length,s=t.match(/^\n?(\t*)/)[1].length;return s>0?t=t.replace(new RegExp(`\\n?\\t{`+s+"}(.*)","g"),function(e,t){return`
`+t}):n>1&&(t=t.replace(new RegExp(`\\n? {`+n+"}(.*)","g"),function(e,t){return`
`+t})),t}function s(e){for(var t,s,o=e.attributes,i=[],n=0,a=o.length;n<a;n++){if(t=o[n].name,s=o[n].value,/data-(markdown|separator|vertical|notes)/gi.test(t))continue;s?i.push(t+'="'+s+'"'):i.push(t)}return i.join(" ")}function o(e){return e=e||{},e.separator=e.separator||DEFAULT_SLIDE_SEPARATOR,e.notesSeparator=e.notesSeparator||DEFAULT_NOTES_SEPARATOR,e.attributes=e.attributes||"",e}function i(e,t){t=o(t);var n=e.split(new RegExp(t.notesSeparator,"mgi"));return n.length===2&&(e=n[0]+'<aside class="notes">'+marked(n[1].trim())+"</aside>"),e=e.replace(/<\/script>/g,SCRIPT_END_PLACEHOLDER),'<script type="text/template">'+e+"<\/script>"}function t(e,t){t=o(t);for(var s,a,r,l,d,h,f,m=new RegExp(t.separator+(t.verticalSeparator?"|"+t.verticalSeparator:""),"mg"),p=new RegExp(t.separator),u=0,c=!0,n=[];l=m.exec(e);)f=null,r=p.test(l[0]),!r&&c&&n.push([]),d=e.substring(u,l.index),r&&c?n.push(d):n[n.length-1].push(d),u=m.lastIndex,c=r;(c?n:n[n.length-1]).push(e.substring(u));for(s="",a=0,h=n.length;a<h;a++)n[a]instanceof Array?(s+="<section "+t.attributes+">",n[a].forEach(function(e){s+="<section data-markdown>"+i(e,t)+"</section>"}),s+="</section>"):s+="<section "+t.attributes+" data-markdown>"+i(n[a],t)+"</section>";return s}function a(e){return new Promise(function(o){var i=[];[].slice.call(e.querySelectorAll("section[data-markdown]:not([data-markdown-parsed])")).forEach(function(e){e.getAttribute("data-markdown").length?i.push(d(e).then(function(n){e.outerHTML=t(n.responseText,{separator:e.getAttribute("data-separator"),verticalSeparator:e.getAttribute("data-separator-vertical"),notesSeparator:e.getAttribute("data-separator-notes"),attributes:s(e)})},function(t,n){e.outerHTML='<section data-state="alert">ERROR: The attempt to fetch '+n+" failed with HTTP status "+t.status+".Check your browser's JavaScript console for more details.<p>Remember that you need to serve the presentation HTML from a HTTP server.</p></section>"})):e.outerHTML=t(n(e),{separator:e.getAttribute("data-separator"),verticalSeparator:e.getAttribute("data-separator-vertical"),notesSeparator:e.getAttribute("data-separator-notes"),attributes:s(e)})}),Promise.all(i).then(o)})}function d(e){return new Promise(function(t,n){var s=new XMLHttpRequest,o=e.getAttribute("data-markdown"),i=e.getAttribute("data-charset");i!=null&&i!=""&&s.overrideMimeType("text/html; charset="+i),s.onreadystatechange=function(e,s){s.readyState===4&&(s.status>=200&&s.status<300||s.status===0?t(s,o):n(s,o))}.bind(this,e,s),s.open("GET",o,!0);try{s.send()}catch(e){console.warn("Failed to get the Markdown file "+o+". Make sure that the presentation and the file are served by a HTTP server and the file can be found there. "+e),t(s,o)}})}function r(e,t,n){var s,i,a,r=new RegExp(n,"mg"),c=new RegExp('([^"= ]+?)="([^"]+?)"|(data-[^"= ]+?)(?=[" ])',"mg"),o=e.nodeValue;if(i=r.exec(o)){for(a=i[1],o=o.substring(0,i.index)+o.substring(r.lastIndex),e.nodeValue=o;s=c.exec(a);)s[2]?t.setAttribute(s[1],s[2]):t.setAttribute(s[3],"");return!0}return!1}function c(e,t,n,s,o){if(t!=null&&t.childNodes!=0[0]&&t.childNodes.length>0)for(var i,a,d,u,h=t,l=0;l<t.childNodes.length;l++){if(i=t.childNodes[l],l>0)for(a=l-1;a>=0;){if(d=t.childNodes[a],typeof d.setAttribute=="function"&&d.tagName!="BR"){h=d;break}a=a-1}u=e,i.nodeName=="section"&&(u=i,h=i),(typeof i.setAttribute=="function"||i.nodeType==Node.COMMENT_NODE)&&c(u,i,h,s,o)}t.nodeType==Node.COMMENT_NODE&&r(t,n,s)==!1&&r(t,e,o)}function l(){var t=e.getRevealElement().querySelectorAll("[data-markdown]:not([data-markdown-parsed])");return[].slice.call(t).forEach(function(e){e.setAttribute("data-markdown-parsed",!0);var t=e.querySelector("aside.notes"),s=n(e);e.innerHTML=marked(s),c(e,e,null,e.getAttribute("data-element-attributes")||e.parentNode.getAttribute("data-element-attributes")||DEFAULT_ELEMENT_ATTRIBUTES_SEPARATOR,e.getAttribute("data-attributes")||e.parentNode.getAttribute("data-attributes")||DEFAULT_SLIDE_ATTRIBUTES_SEPARATOR),t&&e.appendChild(t)}),Promise.resolve()}function u(e){return e.replace(/([&<>'"])/g,e=>HTML_ESCAPE_MAP[e])}return{id:"markdown",init:function(t){e=t;let{renderer:n,animateLists:s,...o}=e.getConfig().markdown||{};return n||(n=new marked.Renderer,n.code=(e,t)=>{let n="";return CODE_LINE_NUMBER_REGEX.test(t)&&(n=t.match(CODE_LINE_NUMBER_REGEX)[1].trim(),n=`data-line-numbers="${n}"`,t=t.replace(CODE_LINE_NUMBER_REGEX,"").trim()),e=u(e),`<pre><code ${n} class="${t}">${e}</code></pre>`}),s===!0&&(n.listitem=e=>`<li class="fragment">${e}</li>`),marked.setOptions({renderer:n,...o}),a(e.getRevealElement()).then(l)},processSlides:a,convertSlides:l,slidify:t,marked}};export default Plugin