<!doctype html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>picman: photo sorting tool</title><link rel="stylesheet" href="/site.css"></head><body><div class="container"><header style="padding:1rem;border-bottom:1px solid #ddd"><h1>picman: photo sorting tool</h1><nav><a href="/">home</a>&nbsp<a href="/archive.html">archive</a>&nbsp</nav></header><main class="article"><span style="display: inline-block; text-align: right; width: 100%;">Posted on 2023/12/31<br>tagged </span><p></p><p>github <a href="https://github.com/sigmonsays/picman">https://github.com/sigmonsays/picman</a></p>
<p>I wrote a basic tool to replace my krufty bash scripts that imports my photos from various locations into
their final resting place.</p>
<p>The tool operates in steps where each step is kind of idempotent. The set of all steps is called
a workflow and operates on a single file. see <a href="https://github.com/sigmonsays/picman/blob/dev/autosort/workflow.go#L18">code</a>.</p>
<p>Each step operates on the same workflow object, which primarily has a state object</p>
<p>State Object <a href="https://github.com/sigmonsays/picman/blob/dev/core/statefile.go#L26">code</a></p>
<ul>
<li>holds exif data</li>
<li>holds file stat information</li>
<li>holds date metadata that is obtained via exif or other logic</li>
<li>holds checksum and logs of processing the file</li>
</ul>
<p>Steps in order</p>
<ul>
<li>StartWorkflow - logs a start workflow</li>
<li>CheckSupportedType - returns core.StopProcessing if file type is not supported</li>
<li>PopulateExif - obtains exif data via json</li>
<li>CheckExif - abandons file processing if it's a text file or if we have no exif data</li>
<li>ObtainDateTaken - gets data taken by looking at various exif data fields</li>
<li>ChecksumFile - obtain checksum of file</li>
<li>GenerateFinalName - generate a destination file name based on date taken</li>
<li>CopyFile - copy file to final destination</li>
</ul>
<p>This process makes it very easy to build tools up around various photo imports.</p>
<p>Finally this tool writes a json summary of how many files were copied if you need to re-index
external photo stores. This allows better integration with tooling like photoprism/photostructure.</p>
<h1>Additional notes</h1>
<p>This tool with syncthing and photoprism has solved my photo needs without relying on a cloud storage
service or photo hosting provider. I own my own photos and have originals backed up at all times.</p>
<p>photo backups are taken daily via restic and stored encrypted in a cloud storage provider (currently backblaze)</p>
</main><footer style="padding:1rem;border-top:1px solid #ddd;margin-top:2rem"><small>Â© Sigmonsays</small></footer></div></body></html>