<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title> sig &middot; sig </title>

  
  <link rel="stylesheet" href="http://sigmonsays.github.io/css/poole.css">
  <link rel="stylesheet" href="http://sigmonsays.github.io/css/syntax.css">
  <link rel="stylesheet" href="http://sigmonsays.github.io/css/hyde.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/favicon.ico">

  
  <link href="http://sigmonsays.github.io/index.xml/" rel="alternate" type="application/rss+xml" title="sig" />
</head>

<body>

<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <h1>sig</h1>
      <p class="lead">
       tech, rants, whatever 
      </p>
    </div>

    <ul class="sidebar-nav">
      <li><a href="/">Home</a> </li>
      
    </ul>

    <p>&copy; 2014. All rights reserved. </p>
  </div>
</div>


    <div class="content container">
<div class="posts">

      
  <div class="post">
    <h1 class="post-title">
      <a href="http://sigmonsays.github.io/2014/09/ban-systemd/">
        ban systemd
      </a>
    </h1>

    <span class="post-date">Mon, Sep 22, 2014</span>

    

<h1 id="toc_0">why I want to ban systemd</h1>

<ol>
<li><p>the developers and members on the irc room are aggressive and counter productive and only seem to want to fight
rather than try to solve any issue.</p></li>

<li><p>I read countless posts about the terrible nature of the developers</p>

<ol>
<li><a href="http://www.infoworld.com/article/2608798/data-center/systemd--harbinger-of-the-linux-apocalypse.html?page=2">http://www.infoworld.com/article/2608798/data-center/systemd--harbinger-of-the-linux-apocalypse.html?page=2</a></li>
</ol></li>

<li><p>Linus Banned a developer for fighting</p></li>
</ol>

<p><a href="https://bugs.freedesktop.org/show_bug.cgi?id=76935">https://bugs.freedesktop.org/show_bug.cgi?id=76935</a></p>

<p>From <a href="https://bugs.freedesktop.org/show_bug.cgi?id=76935#c24">https://bugs.freedesktop.org/show_bug.cgi?id=76935#c24</a></p>

<pre><code>   Systemd needs to be forked NOW.
   Linus explained it well already:
   Kay and Lennart: please just go away, disappear from the FOSS community, we don't need you and your crap.
</code></pre>

<h1 id="toc_1">More updates to follow..</h1>

<p>I&rsquo;m pretty entertained but really saddened by the fact. I joined the IRC room to ask abuot a bug and only
got racial comments and vulgar language when I inquired about a bug. We didn&rsquo;t even get to discussing the
technical reasons, I had to leave the channel. I might try again later, I am curious.</p>

<p>The community needs to reject this overly complex piece of software without a clear focus or direction.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://sigmonsays.github.io/static/firewall/">
        firewall
      </a>
    </h1>

    <span class="post-date">Fri, Sep 12, 2014</span>

    <p>Just a nasty little adhoc firewall script I use to quickly secure a box for any ports it has open.</p>

<p>Only specific networks are allowed.</p>

<pre><code>#!/bin/bash
#set -x

iptables -P INPUT ACCEPT
iptables -P FORWARD ACCEPT
iptables -P OUTPUT ACCEPT

iptables -F INPUT 
#iptables -F FORWARD 
#iptables -F OUTPUT 

function clean_networks {
   grep -v ^# | awk '{print $1}' |grep -v ^$
}

# Quick and dirty iptables firewall
# We want to drop traffic for any open port if its not in the allowed list of IP addresses
# 
function list_allowed_networks {

# the 1918 subnets
cat &lt;&lt; EOF | clean_networks
10.0.0.0/8
172.16.0.0/12
192.168.0.0/16
EOF

cat &lt;&lt; EOF | clean_networks
10.0.0.0/8
127.0.0.0/8
EOF
}

function list_open_ports {
	# ipv4
	netstat -lntu |awk '/^tcp / {print $4}' |awk -F: '{print $2}'
	# ipv6
	netstat -lntu |awk '/^tcp6 / {print $4}' |awk -F: '{print $4}'
}
function list_ports {
	list_open_ports
	echo 22
}
function list_networks {
	for N in $(list_allowed_networks)
	do
		echo $N
	done
	if [ -f /etc/firewall/networks.list ] ; then
		cat /etc/firewall/networks.list
	fi

	# All local addresses
	ip addr | awk -F'[ /]+' '/inet / {print $3}'

	# Let all your connected subnets in..
	# ip addr | awk  '/inet / {print $2}'
}

function prepare_iptables {

	# Create drop logged chain
	if ! iptables -L drop_logged &gt;/dev/null 2&gt;&amp;1 ; then
		iptables -N drop_logged
	fi
	iptables -F drop_logged
	iptables -A drop_logged -j LOG --log-prefix &quot;iptables-dropped: &quot; --log-level 4
	iptables -A drop_logged -j DROP
}



#
# Begin building the firewall
#
prepare_iptables

list_networks | while read N
do
	echo &quot;netowrk $N&quot;
        iptables -A INPUT -s $N -j ACCEPT
done

list_ports | while read P
do
	echo &quot;securing port $P&quot;
        iptables -A INPUT -p tcp --dport $P -j drop_logged
done



</code></pre>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://sigmonsays.github.io/2014/09/building-packages-with-docker/">
        building packages with docker
      </a>
    </h1>

    <span class="post-date">Thu, Sep 11, 2014</span>

    

<p>This is a simple idea I had while waiting for a build to complete.</p>

<p><strong>The background</strong>
Its common to use dpkg-buildpackage inside of a chroot managed by pdebuild. The pdebuild script
takes a minimal base image tarball and installs all dependencies in it required to
build your package.</p>

<p>The build dependencies come from debian/control Build-Depends section. The package being
built is a python application using virtualenv. A lot of the packages come from apt however.
There is a bunch of python pip/easy install work performed too.</p>

<p>Needless to say this takes quite some time to do since extracting a .deb and installing
it is a pretty expensive operation when there is a lot of dependencies.</p>

<p>Obverve the following times</p>

<ul>
<li>pdebuild - 2m35.113s</li>
<li>dpkg-buildpackage - 0m55.480s</li>
<li>docker - 0m37.421s</li>
</ul>

<p>because i&rsquo;m not interested in explaining how the other 2 method work, i&rsquo;ll leave that out. However, let me
explain how the docker build works.</p>

<h2 id="toc_0">docker</h2>

<p>The idea is to exploit the layered file system of containers to provide build dependencies. Since
its a copy on write file system, this means providing a container with all build deps present is
incredibly fast.</p>

<p><strong>Dockerfile</strong></p>

<pre><code>FROM ubuntu
RUN apt-get update \
   &amp;&amp; apt-get install -y dpkg-dev


# This is the key line, it installs the build dependencies for your application!
RUN apt-get build-dep -y --force-yes YOUR_PACKAGE

RUN useradd packaging \
   &amp;&amp; mkdir -p /packaging \
   &amp;&amp; chown packaging /packaging

USER packaging
ADD build.sh /bin/build.sh

ENTRYPOINT [ &quot;/bin/build.sh&quot; ]

</code></pre>

<p><strong>build.sh</strong></p>

<pre><code>#!/bin/bash

echo &quot;[build.sh] $@&quot;

set -x

cd /packaging
pwd
tar vzxf -
cd package
dpkg-buildpackage
</code></pre>

<p>Then to invoke the build we stream the contents at a tar.gz into the container which streams
it to disk and builds the package.</p>

<pre><code>package_stream () 
{ 
    git archive HEAD --format tar --prefix=package/ | gzip -9
}
</code></pre>

<p>Finally, this is the final command that runs the build</p>

<pre><code>  time package_stream | docker run -i debbie 
</code></pre>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://sigmonsays.github.io/2014/09/docker-wishlist/">
        docker wishlist
      </a>
    </h1>

    <span class="post-date">Sun, Sep 7, 2014</span>

    

<p>things I find that I wish docker supported</p>

<h1 id="toc_0">dockerfile</h1>

<ul>
<li><p><strong>store build context with the image</strong></p>

<ul>
<li>provides ability to change original dockerfile for images you download</li>
<li>saves dockerfile and other build artifacts</li>
<li>similar in concept to a &ldquo;source package&rdquo;</li>
</ul></li>

<li><p><strong>support for variables</strong></p></li>
</ul>

<p>There is very little that the dockerfile actually supports beyond basic static directives.</p>

<p>If dockerfile supported templates and variables, we could allow repetitive lines to be reduced to
  the bare minimum. This would allow snippets like this to be greatly reduced. We shouldn&rsquo;t have to
  repeat 0.1.3 everywhere, it should just be a variable!</p>

<pre><code>RUN curl http://example.net/package-0.1.3.tar.gz -o package-0.1.3.tar.gz
RUN tar zxf package-0.1.3.tar.gz 
RUN cd package-0.1.3 &amp;&amp; make &amp;&amp; \
    cp package-0.1.3/bin/whatever /usr/bin/whatever
</code></pre>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://sigmonsays.github.io/2014/09/docker-networking-performance/">
        docker networking performance
      </a>
    </h1>

    <span class="post-date">Fri, Sep 5, 2014</span>

    

<p>While trying to determine the performance overhead of a simple docker container setup, I discovered several
issues related to network performance.</p>

<p>two issues I have encountered</p>

<ul>
<li>docker-proxy handles local network traffic when using the hosts bridge IP (or localhost)</li>
<li>connection tracking overhead of NAT increases memory usage</li>
</ul>

<p>my setup</p>

<p>I am using docker containers as an easy way to deploy backends on a host. I wish to use
the hosts bridge IP as a backend to route requests from the load balancer. The load balancer
is just a haproxy instance running on port 8080 and it uses 500X as backend ports.  I had to
doctor up the output a little but this is still the output of <strong>docker ps</strong>.</p>

<pre><code>07 haproxy:0.0.1-8 X Up 2 days   0.0.0.0:443-&gt;443/tcp     dev1-haproxy-1      
                                 0.0.0.0:1983-&gt;1983/tcp
                                 0.0.0.0:8080-&gt;8080/tcp

b6 api:4.2.0-2   X  Up 14 hours  0.0.0.0:5003-&gt;8080/tcp   dev1-api-3
f0 api:4.2.0-2   X  Up 14 hours  0.0.0.0:5002-&gt;8080/tcp   dev1-api-2
7f api:4.2.0-2   X  Up 15 hours  0.0.0.0:5001-&gt;8080/tcp   dev1-api-1
</code></pre>

<p>I&rsquo;ve measured performance of docker-proxy process using nginx and timing the transfers and have seen
performance degrades around 40-50% due to docker having to reverse proxy the connection in software.</p>

<p>I really believe that if performance is important, there should be a option of disabling docker-proxy,
but I will focus on this more later if I really need to.</p>

<h2 id="toc_0">issues with docker-proxy</h2>

<ul>
<li>software reverse proxy should not be enabled by default</li>
<li>network performance degradation up to 50% is not acceptable when traffic is <em>accidently</em>
routed through the proxy.</li>
</ul>

<p>i&rsquo;m not entirely sure why the userland proxy is even required or why it was introduced.
investigating the proxy history shows proxy was introduced in Apr 2013, commit 930e9a7,
unfortunately it is not easy to determine the intention and why iptables was not just
used in the first place to handle local traffic. iptables is used to route the network
traffic externally, so I wonder, why the proxy in userland. It seems pointless but I
have yet to investigate it further.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://sigmonsays.github.io/2014/09/interesting-tech-2/">
        interesting tech
      </a>
    </h1>

    <span class="post-date">Wed, Sep 3, 2014</span>

    <ul>
<li>tenus - linux networking in golang

<ul>
<li>website <a href="https://github.com/milosgajdos83/tenus">https://github.com/milosgajdos83/tenus</a></li>
<li>mentioned in article - <a href="http://containerops.org/2014/07/30/tenus-golang-powered-linux-networking/">http://containerops.org/2014/07/30/tenus-golang-powered-linux-networking/</a></li>
</ul></li>
</ul>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://sigmonsays.github.io/2014/09/interesting-tech/">
        interesting tech
      </a>
    </h1>

    <span class="post-date">Tue, Sep 2, 2014</span>

    <ul>
<li><p>otro - javascript interpreter in Go - <a href="https://github.com/robertkrimen/otto">https://github.com/robertkrimen/otto</a></p></li>

<li><p>C10M - <a href="http://c10m.robertgraham.com/p/manifesto.html">http://c10m.robertgraham.com/p/manifesto.html</a></p></li>

<li><p>Completely decentralized cloud messaging - <a href="http://iris.karalabe.com">http://iris.karalabe.com</a>
decentralized cloud messaging with broadcast, request/reply and pubsub messaging with literally zero configuration.</p></li>

<li><p>Fast and Simple Open Source &ldquo;Github&rdquo; - <a href="https://github.com/gogits/gogs">https://github.com/gogits/gogs</a></p></li>

<li><p>Quick VPN using SSH - <a href="http://backreference.org/2009/11/13/openssh-based-vpns/">http://backreference.org/2009/11/13/openssh-based-vpns/</a></p></li>

<li><p>Rudder - Software Defined Networks - <a href="https://github.com/coreos/rudder ">https://github.com/coreos/rudder </a></p></li>
</ul>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://sigmonsays.github.io/about/">
        about
      </a>
    </h1>

    <span class="post-date">Tue, Sep 2, 2014</span>

    <p>Start of another blog, developer focused, as a way to write about, keep track of and archive various technologies and trends.</p>

<p>Hopefully this involves into something for now but mostly its a place to put random thought.</p>

  </div>
  


</div>




  </body>
</html>
